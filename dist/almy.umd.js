!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).almy={})}(this,function(t){var e={},n={};function o(t){return"__proto__"!==t&&"constructor"!==t&&"prototype"!==t}var r={create:function(){e={},n={}},state:function(t){return t?e[t]:e},dispatch:function t(r,f,i,p,c){if(r&&"string"==typeof r){for(var l=r.split("->"),a=0;a<l.length;++a)if(!o(l[a]))return;if(!Object.prototype.hasOwnProperty.call(e,r)||e[r]!==f||i){if(e[r]=f,n[r])for(var s=0;s<n[r].length;++s)n[r][s](f);if("object"==typeof f&&null!==f&&!p)for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&t(r+"->"+u,f[u],i,!1,!0);if(!c&&l.length>1){var y=l[l.length-1],h=l.slice(0,-1).join("->");if(!o(h)||!o(y))return;e[h]&&"object"==typeof e[h]||(e[h]={}),e[h][y]=f,t(h,e[h],!0,!0,!1)}}}},subscribe:function(t,o){if(t&&"string"==typeof t)return n[t]||(n[t]=[]),n[t].push(o),Object.prototype.hasOwnProperty.call(e,t)&&o(e[t]),function(){if(n[t]){var e=n[t].indexOf(o);-1!==e&&(n[t].splice(e,1),0===n[t].length&&delete n[t])}}}};t.almy=r});